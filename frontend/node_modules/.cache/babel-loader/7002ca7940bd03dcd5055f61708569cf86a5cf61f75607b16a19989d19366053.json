{"ast":null,"code":"import axios from'axios';const api=axios.create({baseURL:'http://localhost:5001/api',withCredentials:true});// Interceptor to handle 401 errors and refresh tokens\napi.interceptors.response.use(response=>response,async error=>{var _error$response;const originalRequest=error.config;if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401&&!originalRequest._retry){originalRequest._retry=true;// Prevent infinite loop\ntry{const storedAuth=JSON.parse(localStorage.getItem('auth'));const refreshToken=storedAuth===null||storedAuth===void 0?void 0:storedAuth.refreshToken;// Attempt to refresh the token\nconst refreshResponse=await axios.post('/api/auth/refresh-token',{},{headers:{Authorization:`Bearer ${refreshToken}`}});const newAuth={token:refreshResponse.data.accessToken,refreshToken:refreshResponse.data.refreshToken,vendorId:storedAuth.vendorId};localStorage.setItem('auth',JSON.stringify(newAuth));api.defaults.headers.common['Authorization']=`Bearer ${newAuth.token}`;originalRequest.headers['Authorization']=`Bearer ${newAuth.token}`;return api(originalRequest);// Retry the original request\n}catch(refreshError){console.error('Token refresh failed:',refreshError);localStorage.removeItem('auth');window.location.href='/login';// Redirect to login\n}}return Promise.reject(error);});export default api;","map":{"version":3,"names":["axios","api","create","baseURL","withCredentials","interceptors","response","use","error","_error$response","originalRequest","config","status","_retry","storedAuth","JSON","parse","localStorage","getItem","refreshToken","refreshResponse","post","headers","Authorization","newAuth","token","data","accessToken","vendorId","setItem","stringify","defaults","common","refreshError","console","removeItem","window","location","href","Promise","reject"],"sources":["/Users/home/Desktop/weedhurry-platform/v1/frontend/src/api/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst api = axios.create({\n    baseURL: 'http://localhost:5001/api',\n    withCredentials: true,\n});\n\n// Interceptor to handle 401 errors and refresh tokens\napi.interceptors.response.use(\n    (response) => response,\n    async (error) => {\n        const originalRequest = error.config;\n\n        if (error.response?.status === 401 && !originalRequest._retry) {\n            originalRequest._retry = true; // Prevent infinite loop\n            try {\n                const storedAuth = JSON.parse(localStorage.getItem('auth'));\n                const refreshToken = storedAuth?.refreshToken;\n\n                // Attempt to refresh the token\n                const refreshResponse = await axios.post('/api/auth/refresh-token', {}, {\n                    headers: { Authorization: `Bearer ${refreshToken}` },\n                });\n\n                const newAuth = {\n                    token: refreshResponse.data.accessToken,\n                    refreshToken: refreshResponse.data.refreshToken,\n                    vendorId: storedAuth.vendorId,\n                };\n\n                localStorage.setItem('auth', JSON.stringify(newAuth));\n                api.defaults.headers.common['Authorization'] = `Bearer ${newAuth.token}`;\n                originalRequest.headers['Authorization'] = `Bearer ${newAuth.token}`;\n\n                return api(originalRequest); // Retry the original request\n            } catch (refreshError) {\n                console.error('Token refresh failed:', refreshError);\n                localStorage.removeItem('auth');\n                window.location.href = '/login'; // Redirect to login\n            }\n        }\n\n        return Promise.reject(error);\n    }\n);\n\nexport default api;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CAEzB,KAAM,CAAAC,GAAG,CAAGD,KAAK,CAACE,MAAM,CAAC,CACrBC,OAAO,CAAE,2BAA2B,CACpCC,eAAe,CAAE,IACrB,CAAC,CAAC,CAEF;AACAH,GAAG,CAACI,YAAY,CAACC,QAAQ,CAACC,GAAG,CACxBD,QAAQ,EAAKA,QAAQ,CACtB,KAAO,CAAAE,KAAK,EAAK,KAAAC,eAAA,CACb,KAAM,CAAAC,eAAe,CAAGF,KAAK,CAACG,MAAM,CAEpC,GAAI,EAAAF,eAAA,CAAAD,KAAK,CAACF,QAAQ,UAAAG,eAAA,iBAAdA,eAAA,CAAgBG,MAAM,IAAK,GAAG,EAAI,CAACF,eAAe,CAACG,MAAM,CAAE,CAC3DH,eAAe,CAACG,MAAM,CAAG,IAAI,CAAE;AAC/B,GAAI,CACA,KAAM,CAAAC,UAAU,CAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,CAC3D,KAAM,CAAAC,YAAY,CAAGL,UAAU,SAAVA,UAAU,iBAAVA,UAAU,CAAEK,YAAY,CAE7C;AACA,KAAM,CAAAC,eAAe,CAAG,KAAM,CAAApB,KAAK,CAACqB,IAAI,CAAC,yBAAyB,CAAE,CAAC,CAAC,CAAE,CACpEC,OAAO,CAAE,CAAEC,aAAa,CAAE,UAAUJ,YAAY,EAAG,CACvD,CAAC,CAAC,CAEF,KAAM,CAAAK,OAAO,CAAG,CACZC,KAAK,CAAEL,eAAe,CAACM,IAAI,CAACC,WAAW,CACvCR,YAAY,CAAEC,eAAe,CAACM,IAAI,CAACP,YAAY,CAC/CS,QAAQ,CAAEd,UAAU,CAACc,QACzB,CAAC,CAEDX,YAAY,CAACY,OAAO,CAAC,MAAM,CAAEd,IAAI,CAACe,SAAS,CAACN,OAAO,CAAC,CAAC,CACrDvB,GAAG,CAAC8B,QAAQ,CAACT,OAAO,CAACU,MAAM,CAAC,eAAe,CAAC,CAAG,UAAUR,OAAO,CAACC,KAAK,EAAE,CACxEf,eAAe,CAACY,OAAO,CAAC,eAAe,CAAC,CAAG,UAAUE,OAAO,CAACC,KAAK,EAAE,CAEpE,MAAO,CAAAxB,GAAG,CAACS,eAAe,CAAC,CAAE;AACjC,CAAE,MAAOuB,YAAY,CAAE,CACnBC,OAAO,CAAC1B,KAAK,CAAC,uBAAuB,CAAEyB,YAAY,CAAC,CACpDhB,YAAY,CAACkB,UAAU,CAAC,MAAM,CAAC,CAC/BC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,QAAQ,CAAE;AACrC,CACJ,CAEA,MAAO,CAAAC,OAAO,CAACC,MAAM,CAAChC,KAAK,CAAC,CAChC,CACJ,CAAC,CAED,cAAe,CAAAP,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}