{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import axios from'axios';import api from'../utils/api';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[auth,setAuth]=useState(null);const[loading,setLoading]=useState(true);// Function to log in the user\nconst login=async vendorId=>{setAuth({vendorId});// Update auth state directly\n};const logout=async()=>{try{await axios.post('/auth/logout',{},{withCredentials:true// Include credentials for the request\n});setAuth(null);// Clear authentication state\nwindow.location.href='/login';// Redirect to login page\n}catch(error){console.error('Logout failed:',error.message);}};// Function to check authentication status\nconst checkAuthStatus=async()=>{try{var _response$data;const response=await axios.get('/auth/validate',{withCredentials:true});if((_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.success&&response.data.vendorId){setAuth({vendorId:response.data.vendorId});}else{setAuth(null);}}catch(error){console.error('Error validating auth:',error);setAuth(null);}finally{setLoading(false);}};// Call checkAuthStatus on mount only for protected pages\nuseEffect(()=>{// Define public routes that don't require authentication\nconst publicRoutes=['/vendor-store','/home','/about'];// Add public route paths here\nconst currentPath=window.location.pathname;// Check if the current path matches any public route\nconst isPublicRoute=publicRoutes.some(route=>currentPath.startsWith(route));if(!isPublicRoute){checkAuthStatus();// Check auth status only on protected routes\n}else{setLoading(false);// Skip auth check for public routes\n}},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{auth,login,logout,loading},children:loading?/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"}):children});};export const useAuth=()=>{return useContext(AuthContext);};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","auth","setAuth","loading","setLoading","login","vendorId","logout","post","withCredentials","window","location","href","error","console","message","checkAuthStatus","_response$data","response","get","data","success","publicRoutes","currentPath","pathname","isPublicRoute","some","route","startsWith","Provider","value","useAuth"],"sources":["/Users/home/Desktop/weedhurry-platform/v1/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport axios from 'axios';\nimport api from '../utils/api';\n\nexport const AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n    const [auth, setAuth] = useState(null);\n    const [loading, setLoading] = useState(true);\n\n    // Function to log in the user\n    const login = async (vendorId) => {\n        setAuth({ vendorId }); // Update auth state directly\n    };\n\n    const logout = async () => {\n        try {\n            await axios.post('/auth/logout', {}, {\n                withCredentials: true, // Include credentials for the request\n            });\n            setAuth(null); // Clear authentication state\n            window.location.href = '/login'; // Redirect to login page\n        } catch (error) {\n            console.error('Logout failed:', error.message);\n        }\n    };\n\n    // Function to check authentication status\n    const checkAuthStatus = async () => {\n        try {\n            const response = await axios.get('/auth/validate', {\n                withCredentials: true,\n            });\n\n            if (response.data?.success && response.data.vendorId) {\n                setAuth({ vendorId: response.data.vendorId });\n            } else {\n                setAuth(null);\n            }\n        } catch (error) {\n            console.error('Error validating auth:', error);\n            setAuth(null);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    // Call checkAuthStatus on mount only for protected pages\n    useEffect(() => {\n        // Define public routes that don't require authentication\n        const publicRoutes = ['/vendor-store', '/home', '/about']; // Add public route paths here\n        const currentPath = window.location.pathname;\n\n        // Check if the current path matches any public route\n        const isPublicRoute = publicRoutes.some((route) => currentPath.startsWith(route));\n\n        if (!isPublicRoute) {\n            checkAuthStatus(); // Check auth status only on protected routes\n        } else {\n            setLoading(false); // Skip auth check for public routes\n        }\n    }, []);\n\n    return (\n        <AuthContext.Provider value={{ auth, login, logout, loading }}>\n            {loading ? <div>Loading...</div> : children}\n        </AuthContext.Provider>\n    );\n};\n\nexport const useAuth = () => {\n    return useContext(AuthContext);\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}