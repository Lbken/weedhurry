{"ast":null,"code":"// NearbyPickupPage.js\nimport React,{useEffect,useState,useRef}from'react';import VendorCard from'./VendorCard';import PickupMap from'./PickupMap';import Footer from'./Footer';import'./NearbyPickupPage.css';import api from'../api/api';import{enrichVendor}from'../utils/coordinateUtils';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NearbyPickupPage=_ref=>{let{searchQuery}=_ref;const[vendors,setVendors]=useState([]);const[error,setError]=useState(null);const[loading,setLoading]=useState(false);const[isExpanded,setIsExpanded]=useState(false);const vendorCardsRef=useRef(null);const lastScrollPosition=useRef(0);const fetchVendors=async()=>{setLoading(true);try{// Get user's location from localStorage\nconst savedAddress=localStorage.getItem('userAddress');if(!savedAddress)throw new Error('No address found');// Geocode the address\nconst geocodeResponse=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(savedAddress)}&key=${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}`);const geocodeData=await geocodeResponse.json();if(geocodeData.status!=='OK')throw new Error('Could not fetch location');const{lat,lng}=geocodeData.results[0].geometry.location;console.log('User location:',{lat,lng});// Fetch nearby vendors\nconst{data:vendorsData}=await api.get('/api/map/map-vendors',{params:{lat,lng}});if(!(vendorsData!==null&&vendorsData!==void 0&&vendorsData.vendors)||!Array.isArray(vendorsData.vendors)){throw new Error('No vendors found near your location');}// Process vendors with the utility function\nconst enrichedVendors=vendorsData.vendors.filter(vendor=>['Pickup','Pickup & Delivery'].includes(vendor.dispensaryType)).map(vendor=>enrichVendor(vendor,lat,lng)).filter(Boolean).sort((a,b)=>a.milesAway-b.milesAway);console.log('Processed vendors:',enrichedVendors);setVendors(enrichedVendors);setError(null);}catch(error){console.error('Error fetching vendors:',error);setError(error.message||'Failed to load vendors');setVendors([]);}finally{setLoading(false);}};const handleMarkerClick=vendor=>{setVendors(prevVendors=>{const filteredVendors=prevVendors.filter(v=>v._id!==vendor._id);return[vendor,...filteredVendors];});};// Filter vendors based on search query\nconst filteredVendors=vendors.map(vendor=>{var _vendor$products;const filteredProducts=((_vendor$products=vendor.products)===null||_vendor$products===void 0?void 0:_vendor$products.filter(product=>{var _product$name,_product$brand,_product$strain;const query=searchQuery.trim().toLowerCase();return((_product$name=product.name)===null||_product$name===void 0?void 0:_product$name.toLowerCase().includes(query))||((_product$brand=product.brand)===null||_product$brand===void 0?void 0:_product$brand.toLowerCase().includes(query))||((_product$strain=product.strain)===null||_product$strain===void 0?void 0:_product$strain.toLowerCase().includes(query));}))||[];return{...vendor,products:filteredProducts};});useEffect(()=>{fetchVendors();},[]);const handleScroll=e=>{const currentScroll=e.target.scrollTop;const scrollingDown=currentScroll>lastScrollPosition.current;const scrollingUp=currentScroll<lastScrollPosition.current;if(scrollingDown&&!isExpanded&&currentScroll>10){setIsExpanded(true);}if(scrollingUp&&isExpanded&&currentScroll===0){const scrollDelta=lastScrollPosition.current-currentScroll;if(scrollDelta>5){setIsExpanded(false);}}lastScrollPosition.current=currentScroll;};const handleDragHandleClick=e=>{e.stopPropagation();setIsExpanded(!isExpanded);};return/*#__PURE__*/_jsxs(\"div\",{className:\"container-fluid p-0 pickup-page-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:`map-container ${isExpanded?'expanded':''}`,children:/*#__PURE__*/_jsx(PickupMap,{dispensaries:vendors,onMarkerClick:handleMarkerClick})}),/*#__PURE__*/_jsxs(\"div\",{className:`vendor-card-container ${isExpanded?'expanded':''}`,children:[/*#__PURE__*/_jsx(\"div\",{className:\"drag-handle\",onClick:handleDragHandleClick}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"text-center my-4\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Loading vendors...\"})}):error?/*#__PURE__*/_jsx(\"div\",{className:\"text-center my-4\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-danger\",children:error})}):filteredVendors.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"vendor-cards-wrapper px-0\",ref:vendorCardsRef,onScroll:handleScroll,children:[filteredVendors.map(vendor=>/*#__PURE__*/_jsx(VendorCard,{vendor:vendor,orderType:\"Pickup\"},vendor._id)),/*#__PURE__*/_jsx(Footer,{})]}):/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-muted my-4\",children:searchQuery?'No products match your search query.':'No vendors found in your area.'})]})]});};export default NearbyPickupPage;","map":{"version":3,"names":["React","useEffect","useState","useRef","VendorCard","PickupMap","Footer","api","enrichVendor","jsx","_jsx","jsxs","_jsxs","NearbyPickupPage","_ref","searchQuery","vendors","setVendors","error","setError","loading","setLoading","isExpanded","setIsExpanded","vendorCardsRef","lastScrollPosition","fetchVendors","savedAddress","localStorage","getItem","Error","geocodeResponse","fetch","encodeURIComponent","process","env","REACT_APP_GOOGLE_MAPS_API_KEY","geocodeData","json","status","lat","lng","results","geometry","location","console","log","data","vendorsData","get","params","Array","isArray","enrichedVendors","filter","vendor","includes","dispensaryType","map","Boolean","sort","a","b","milesAway","message","handleMarkerClick","prevVendors","filteredVendors","v","_id","_vendor$products","filteredProducts","products","product","_product$name","_product$brand","_product$strain","query","trim","toLowerCase","name","brand","strain","handleScroll","e","currentScroll","target","scrollTop","scrollingDown","current","scrollingUp","scrollDelta","handleDragHandleClick","stopPropagation","className","children","dispensaries","onMarkerClick","onClick","length","ref","onScroll","orderType"],"sources":["/Users/home/Desktop/weedhurry-platform/v1/frontend/src/components/NearbyPickupPage.js"],"sourcesContent":["// NearbyPickupPage.js\nimport React, { useEffect, useState, useRef } from 'react';\nimport VendorCard from './VendorCard';\nimport PickupMap from './PickupMap';\nimport Footer from './Footer';\nimport './NearbyPickupPage.css';\nimport api from '../api/api';\nimport { enrichVendor } from '../utils/coordinateUtils';\n\nconst NearbyPickupPage = ({ searchQuery }) => {\n  const [vendors, setVendors] = useState([]);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [isExpanded, setIsExpanded] = useState(false);\n  const vendorCardsRef = useRef(null);\n  const lastScrollPosition = useRef(0);\n\n  const fetchVendors = async () => {\n    setLoading(true);\n    try {\n      // Get user's location from localStorage\n      const savedAddress = localStorage.getItem('userAddress');\n      if (!savedAddress) throw new Error('No address found');\n\n      // Geocode the address\n      const geocodeResponse = await fetch(\n        `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(\n          savedAddress\n        )}&key=${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}`\n      );\n      const geocodeData = await geocodeResponse.json();\n      if (geocodeData.status !== 'OK') throw new Error('Could not fetch location');\n\n      const { lat, lng } = geocodeData.results[0].geometry.location;\n      console.log('User location:', { lat, lng });\n\n      // Fetch nearby vendors\n      const { data: vendorsData } = await api.get('/api/map/map-vendors', {\n        params: { lat, lng }\n      });\n\n      if (!vendorsData?.vendors || !Array.isArray(vendorsData.vendors)) {\n        throw new Error('No vendors found near your location');\n      }\n\n      // Process vendors with the utility function\n      const enrichedVendors = vendorsData.vendors\n        .filter(vendor => ['Pickup', 'Pickup & Delivery'].includes(vendor.dispensaryType))\n        .map(vendor => enrichVendor(vendor, lat, lng))\n        .filter(Boolean)\n        .sort((a, b) => a.milesAway - b.milesAway);\n\n      console.log('Processed vendors:', enrichedVendors);\n      setVendors(enrichedVendors);\n      setError(null);\n    } catch (error) {\n      console.error('Error fetching vendors:', error);\n      setError(error.message || 'Failed to load vendors');\n      setVendors([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleMarkerClick = (vendor) => {\n    setVendors((prevVendors) => {\n      const filteredVendors = prevVendors.filter((v) => v._id !== vendor._id);\n      return [vendor, ...filteredVendors];\n    });\n  };\n\n  // Filter vendors based on search query\n  const filteredVendors = vendors.map((vendor) => {\n    const filteredProducts = vendor.products?.filter((product) => {\n      const query = searchQuery.trim().toLowerCase();\n      return (\n        product.name?.toLowerCase().includes(query) ||\n        product.brand?.toLowerCase().includes(query) ||\n        product.strain?.toLowerCase().includes(query)\n      );\n    }) || [];\n\n    return { ...vendor, products: filteredProducts };\n  });\n\n  useEffect(() => {\n    fetchVendors();\n  }, []);\n\n  const handleScroll = (e) => {\n    const currentScroll = e.target.scrollTop;\n    const scrollingDown = currentScroll > lastScrollPosition.current;\n    const scrollingUp = currentScroll < lastScrollPosition.current;\n    \n    if (scrollingDown && !isExpanded && currentScroll > 10) {\n      setIsExpanded(true);\n    }\n    \n    if (scrollingUp && isExpanded && currentScroll === 0) {\n      const scrollDelta = lastScrollPosition.current - currentScroll;\n      if (scrollDelta > 5) {\n        setIsExpanded(false);\n      }\n    }\n\n    lastScrollPosition.current = currentScroll;\n  };\n\n  const handleDragHandleClick = (e) => {\n    e.stopPropagation();\n    setIsExpanded(!isExpanded);\n  };\n\n  return (\n    <div className=\"container-fluid p-0 pickup-page-container\">\n      <div className={`map-container ${isExpanded ? 'expanded' : ''}`}>\n        <PickupMap\n          dispensaries={vendors}\n          onMarkerClick={handleMarkerClick}\n        />\n      </div>\n\n      <div className={`vendor-card-container ${isExpanded ? 'expanded' : ''}`}>\n        <div\n          className=\"drag-handle\"\n          onClick={handleDragHandleClick}\n        />\n        {loading ? (\n          <div className=\"text-center my-4\">\n            <p>Loading vendors...</p>\n          </div>\n        ) : error ? (\n          <div className=\"text-center my-4\">\n            <p className=\"text-danger\">{error}</p>\n          </div>\n        ) : filteredVendors.length > 0 ? (\n          <div \n            className=\"vendor-cards-wrapper px-0\"\n            ref={vendorCardsRef}\n            onScroll={handleScroll}\n          >\n            {filteredVendors.map((vendor) => (\n              <VendorCard \n                key={vendor._id} \n                vendor={vendor} \n                orderType=\"Pickup\" \n              />\n            ))}\n            <Footer />\n          </div>\n        ) : (\n          <p className=\"text-center text-muted my-4\">\n            {searchQuery ? 'No products match your search query.' : 'No vendors found in your area.'}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default NearbyPickupPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}