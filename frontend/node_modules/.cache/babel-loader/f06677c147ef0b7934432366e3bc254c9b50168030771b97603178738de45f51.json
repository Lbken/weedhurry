{"ast":null,"code":"import axios from'axios';// Environment-based configuration\nconst isDevelopment=process.env.NODE_ENV==='development';const baseURL=isDevelopment?'http://localhost:5001/api':'https://api.weedhurry.com/api';// Cookie configuration\nconst getCookieConfig=()=>({path:'/',domain:isDevelopment?undefined:'.weedhurry.com',secure:!isDevelopment,sameSite:isDevelopment?'Lax':'None'});// Create axios instance\nconst api=axios.create({baseURL,withCredentials:true,timeout:isDevelopment?30000:60000,// Longer timeout in production for proxy\nheaders:{'Content-Type':'application/json','Accept':'application/json, text/plain, */*','X-Requested-With':'XMLHttpRequest'// Help prevent CSRF\n},// Proxy settings for development\nproxy:isDevelopment?false:undefined});// Request interceptor\napi.interceptors.request.use(config=>{// Remove Content-Type for FormData\nif(config.data instanceof FormData){delete config.headers['Content-Type'];}// Add timestamp to prevent caching\nconfig.params={...config.params,_t:Date.now()};// Log requests in development\nif(isDevelopment){console.log('API Request:',{url:config.url,method:config.method,params:config.params,headers:config.headers});}return config;},error=>{console.error('Request interceptor error:',error);return Promise.reject(error);});// Response interceptor with enhanced error handling\napi.interceptors.response.use(response=>{// Log successful responses in development\nif(isDevelopment){console.log('API Response:',{url:response.config.url,status:response.status,data:response.data});}return response;},async error=>{var _error$response,_error$response2,_error$response3,_error$response4;const originalRequest=error.config;// Log detailed error information\nconsole.error('API Error:',{url:originalRequest===null||originalRequest===void 0?void 0:originalRequest.url,method:originalRequest===null||originalRequest===void 0?void 0:originalRequest.method,status:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status,message:error.message,response:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data});// Don't retry these requests\nconst skipRetry=(originalRequest===null||originalRequest===void 0?void 0:originalRequest._retry)||(originalRequest===null||originalRequest===void 0?void 0:originalRequest.url)==='/auth/logout'||((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)===404;if(skipRetry){return Promise.reject(error);}// Handle 401 Unauthorized\nif(((_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.status)===401&&!originalRequest._retry){originalRequest._retry=true;try{var _response$data;const response=await api.post('/auth/refresh-token');if((_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.success){// Retry the original request\nreturn api(originalRequest);}}catch(refreshError){console.error('Token refresh failed:',refreshError);handleAuthFailure();return Promise.reject(refreshError);}}// Handle specific error cases\nif(error.code==='ECONNABORTED'){console.error('Request timeout:',originalRequest===null||originalRequest===void 0?void 0:originalRequest.url);}else if(error.message==='Network Error'){console.error('Network error:',error);}return Promise.reject(error);});const handleAuthFailure=()=>{const publicRoutes=['/','/nearby','/login','/register'];const cookieConfig=getCookieConfig();// Clear cookies with proper configuration\nconst cookieOptions=`Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT; ${cookieConfig.domain?`Domain=${cookieConfig.domain};`:''} ${cookieConfig.secure?'Secure;':''} SameSite=${cookieConfig.sameSite}`;document.cookie=`accessToken=; ${cookieOptions}`;document.cookie=`refreshToken=; ${cookieOptions}`;// Clear storage\nlocalStorage.removeItem('auth');sessionStorage.removeItem('auth');// Add a small delay to ensure cookies are cleared\nsetTimeout(()=>{if(!publicRoutes.includes(window.location.pathname)){window.location.href='/login';}},100);};// Export helper for checking connection status\nexport const checkApiConnection=async()=>{try{const response=await api.get('/health');return{status:'connected',details:response.data};}catch(error){return{status:'error',details:error.message};}};export default api;","map":{"version":3,"names":["axios","isDevelopment","process","env","NODE_ENV","baseURL","getCookieConfig","path","domain","undefined","secure","sameSite","api","create","withCredentials","timeout","headers","proxy","interceptors","request","use","config","data","FormData","params","_t","Date","now","console","log","url","method","error","Promise","reject","response","status","_error$response","_error$response2","_error$response3","_error$response4","originalRequest","message","skipRetry","_retry","_response$data","post","success","refreshError","handleAuthFailure","code","publicRoutes","cookieConfig","cookieOptions","document","cookie","localStorage","removeItem","sessionStorage","setTimeout","includes","window","location","pathname","href","checkApiConnection","get","details"],"sources":["/Users/home/Desktop/weedhurry-platform/v1/frontend/src/api/api.js"],"sourcesContent":["import axios from 'axios';\n\n// Environment-based configuration\nconst isDevelopment = process.env.NODE_ENV === 'development';\nconst baseURL = isDevelopment \n    ? 'http://localhost:5001/api'\n    : 'https://api.weedhurry.com/api';\n\n// Cookie configuration\nconst getCookieConfig = () => ({\n    path: '/',\n    domain: isDevelopment ? undefined : '.weedhurry.com',\n    secure: !isDevelopment,\n    sameSite: isDevelopment ? 'Lax' : 'None'\n});\n\n// Create axios instance\nconst api = axios.create({\n    baseURL,\n    withCredentials: true,\n    timeout: isDevelopment ? 30000 : 60000, // Longer timeout in production for proxy\n    headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json, text/plain, */*',\n        'X-Requested-With': 'XMLHttpRequest' // Help prevent CSRF\n    },\n    // Proxy settings for development\n    proxy: isDevelopment ? false : undefined\n});\n\n// Request interceptor\napi.interceptors.request.use(\n    (config) => {\n        // Remove Content-Type for FormData\n        if (config.data instanceof FormData) {\n            delete config.headers['Content-Type'];\n        }\n        \n        // Add timestamp to prevent caching\n        config.params = {\n            ...config.params,\n            _t: Date.now()\n        };\n\n        // Log requests in development\n        if (isDevelopment) {\n            console.log('API Request:', {\n                url: config.url,\n                method: config.method,\n                params: config.params,\n                headers: config.headers\n            });\n        }\n\n        return config;\n    },\n    (error) => {\n        console.error('Request interceptor error:', error);\n        return Promise.reject(error);\n    }\n);\n\n// Response interceptor with enhanced error handling\napi.interceptors.response.use(\n    (response) => {\n        // Log successful responses in development\n        if (isDevelopment) {\n            console.log('API Response:', {\n                url: response.config.url,\n                status: response.status,\n                data: response.data\n            });\n        }\n        return response;\n    },\n    async (error) => {\n        const originalRequest = error.config;\n\n        // Log detailed error information\n        console.error('API Error:', {\n            url: originalRequest?.url,\n            method: originalRequest?.method,\n            status: error.response?.status,\n            message: error.message,\n            response: error.response?.data\n        });\n\n        // Don't retry these requests\n        const skipRetry = \n            originalRequest?._retry || \n            originalRequest?.url === '/auth/logout' ||\n            error.response?.status === 404;\n\n        if (skipRetry) {\n            return Promise.reject(error);\n        }\n\n        // Handle 401 Unauthorized\n        if (error.response?.status === 401 && !originalRequest._retry) {\n            originalRequest._retry = true;\n            try {\n                const response = await api.post('/auth/refresh-token');\n                if (response.data?.success) {\n                    // Retry the original request\n                    return api(originalRequest);\n                }\n            } catch (refreshError) {\n                console.error('Token refresh failed:', refreshError);\n                handleAuthFailure();\n                return Promise.reject(refreshError);\n            }\n        }\n\n        // Handle specific error cases\n        if (error.code === 'ECONNABORTED') {\n            console.error('Request timeout:', originalRequest?.url);\n        } else if (error.message === 'Network Error') {\n            console.error('Network error:', error);\n        }\n\n        return Promise.reject(error);\n    }\n);\n\nconst handleAuthFailure = () => {\n    const publicRoutes = ['/', '/nearby', '/login', '/register'];\n    const cookieConfig = getCookieConfig();\n    \n    // Clear cookies with proper configuration\n    const cookieOptions = `Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT; ${\n        cookieConfig.domain ? `Domain=${cookieConfig.domain};` : ''\n    } ${cookieConfig.secure ? 'Secure;' : ''} SameSite=${cookieConfig.sameSite}`;\n    \n    document.cookie = `accessToken=; ${cookieOptions}`;\n    document.cookie = `refreshToken=; ${cookieOptions}`;\n    \n    // Clear storage\n    localStorage.removeItem('auth');\n    sessionStorage.removeItem('auth');\n\n    // Add a small delay to ensure cookies are cleared\n    setTimeout(() => {\n        if (!publicRoutes.includes(window.location.pathname)) {\n            window.location.href = '/login';\n        }\n    }, 100);\n};\n\n// Export helper for checking connection status\nexport const checkApiConnection = async () => {\n    try {\n        const response = await api.get('/health');\n        return {\n            status: 'connected',\n            details: response.data\n        };\n    } catch (error) {\n        return {\n            status: 'error',\n            details: error.message\n        };\n    }\n};\n\nexport default api;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}