{"ast":null,"code":"// NearbyVendorsPage.js\nimport React,{useEffect,useState}from'react';import VendorCard from'./VendorCard';import Footer from'./Footer';import api from'../api/api';import{enrichVendor}from'../utils/coordinateUtils';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NearbyVendorsPage=_ref=>{let{searchQuery}=_ref;const[vendors,setVendors]=useState([]);const[error,setError]=useState(null);const[loading,setLoading]=useState(false);const[parsedAddress,setParsedAddress]=useState({street:'',city:'',stateAbbreviation:''});// Process saved address when component mounts\nuseEffect(()=>{const savedAddress=localStorage.getItem('userAddress');if(savedAddress){var _parts$,_parts$2,_parts$3;const parts=savedAddress.split(',');setParsedAddress({street:((_parts$=parts[0])===null||_parts$===void 0?void 0:_parts$.trim())||'',city:((_parts$2=parts[1])===null||_parts$2===void 0?void 0:_parts$2.trim())||'',stateAbbreviation:((_parts$3=parts[2])===null||_parts$3===void 0?void 0:_parts$3.trim().split(' ')[0])||''});}},[]);const fetchVendors=async()=>{setLoading(true);try{const savedAddress=localStorage.getItem('userAddress');if(!savedAddress){throw new Error('No address found');}// Get coordinates using geocoding\nconst geocodeResponse=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(savedAddress)}&key=${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}`);const geocodeData=await geocodeResponse.json();if(geocodeData.status!=='OK'){throw new Error('Could not find location');}const{lat,lng}=geocodeData.results[0].geometry.location;console.log('User location:',{lat,lng});// Fetch nearby vendors\nconst{data:vendorsData}=await api.get('/api/map/map-vendors',{params:{lat,lng}});if(!(vendorsData!==null&&vendorsData!==void 0&&vendorsData.vendors)||!Array.isArray(vendorsData.vendors)){throw new Error('No vendors found near your location');}// Process vendors with the utility function\nconst processedVendors=vendorsData.vendors.filter(vendor=>['Delivery','Pickup & Delivery'].includes(vendor.dispensaryType)).map(vendor=>enrichVendor(vendor,lat,lng)).filter(Boolean).sort((a,b)=>a.milesAway-b.milesAway);console.log('Processed vendors:',processedVendors);setVendors(processedVendors);setError(null);}catch(error){console.error('Error fetching vendors:',error);setError(error.message||'Failed to load vendors');setVendors([]);}finally{setLoading(false);}};// Initial load of vendors\nuseEffect(()=>{fetchVendors();},[]);// Filter vendors based on search query\nconst filteredVendors=vendors.map(vendor=>{var _vendor$products;const filteredProducts=((_vendor$products=vendor.products)===null||_vendor$products===void 0?void 0:_vendor$products.filter(product=>{var _product$name,_product$brand,_product$strain;const query=searchQuery.trim().toLowerCase();return((_product$name=product.name)===null||_product$name===void 0?void 0:_product$name.toLowerCase().includes(query))||((_product$brand=product.brand)===null||_product$brand===void 0?void 0:_product$brand.toLowerCase().includes(query))||((_product$strain=product.strain)===null||_product$strain===void 0?void 0:_product$strain.toLowerCase().includes(query));}))||[];return{...vendor,products:filteredProducts};});return/*#__PURE__*/_jsxs(\"div\",{className:\"container-fluid p-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"vendor-list\",children:loading?/*#__PURE__*/_jsx(\"p\",{className:\"text-center my-4\",children:\"Loading vendors...\"}):error?/*#__PURE__*/_jsx(\"p\",{className:\"text-danger text-center my-4\",children:error}):filteredVendors.length>0?filteredVendors.map(vendor=>/*#__PURE__*/_jsx(\"div\",{className:\"vendors-page vendor-card-wrapper\",children:/*#__PURE__*/_jsx(VendorCard,{vendor:vendor,orderType:\"Delivery\"})},vendor._id)):/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-muted my-4\",children:searchQuery?'No vendors match your search.':'No vendors found in your area.'})}),/*#__PURE__*/_jsx(Footer,{})]});};export default NearbyVendorsPage;","map":{"version":3,"names":["React","useEffect","useState","VendorCard","Footer","api","enrichVendor","jsx","_jsx","jsxs","_jsxs","NearbyVendorsPage","_ref","searchQuery","vendors","setVendors","error","setError","loading","setLoading","parsedAddress","setParsedAddress","street","city","stateAbbreviation","savedAddress","localStorage","getItem","_parts$","_parts$2","_parts$3","parts","split","trim","fetchVendors","Error","geocodeResponse","fetch","encodeURIComponent","process","env","REACT_APP_GOOGLE_MAPS_API_KEY","geocodeData","json","status","lat","lng","results","geometry","location","console","log","data","vendorsData","get","params","Array","isArray","processedVendors","filter","vendor","includes","dispensaryType","map","Boolean","sort","a","b","milesAway","message","filteredVendors","_vendor$products","filteredProducts","products","product","_product$name","_product$brand","_product$strain","query","toLowerCase","name","brand","strain","className","children","length","orderType","_id"],"sources":["/Users/home/Desktop/weedhurry-platform/v1/frontend/src/components/NearbyVendorsPage.js"],"sourcesContent":["// NearbyVendorsPage.js\nimport React, { useEffect, useState } from 'react';\nimport VendorCard from './VendorCard';\nimport Footer from './Footer';\nimport api from '../api/api';\nimport { enrichVendor } from '../utils/coordinateUtils';\n\nconst NearbyVendorsPage = ({ searchQuery }) => {\n  const [vendors, setVendors] = useState([]);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [parsedAddress, setParsedAddress] = useState({\n    street: '',\n    city: '',\n    stateAbbreviation: ''\n  });\n\n  // Process saved address when component mounts\n  useEffect(() => {\n    const savedAddress = localStorage.getItem('userAddress');\n    if (savedAddress) {\n      const parts = savedAddress.split(',');\n      setParsedAddress({\n        street: parts[0]?.trim() || '',\n        city: parts[1]?.trim() || '',\n        stateAbbreviation: parts[2]?.trim().split(' ')[0] || '',\n      });\n    }\n  }, []);\n\n  const fetchVendors = async () => {\n    setLoading(true);\n    try {\n      const savedAddress = localStorage.getItem('userAddress');\n      if (!savedAddress) {\n        throw new Error('No address found');\n      }\n\n      // Get coordinates using geocoding\n      const geocodeResponse = await fetch(\n        `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(\n          savedAddress\n        )}&key=${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}`\n      );\n      const geocodeData = await geocodeResponse.json();\n      \n      if (geocodeData.status !== 'OK') {\n        throw new Error('Could not find location');\n      }\n\n      const { lat, lng } = geocodeData.results[0].geometry.location;\n      console.log('User location:', { lat, lng });\n\n      // Fetch nearby vendors\n      const { data: vendorsData } = await api.get('/api/map/map-vendors', {\n        params: { lat, lng }\n      });\n\n      if (!vendorsData?.vendors || !Array.isArray(vendorsData.vendors)) {\n        throw new Error('No vendors found near your location');\n      }\n\n      // Process vendors with the utility function\n      const processedVendors = vendorsData.vendors\n        .filter(vendor => ['Delivery', 'Pickup & Delivery'].includes(vendor.dispensaryType))\n        .map(vendor => enrichVendor(vendor, lat, lng))\n        .filter(Boolean)\n        .sort((a, b) => a.milesAway - b.milesAway);\n\n      console.log('Processed vendors:', processedVendors);\n      setVendors(processedVendors);\n      setError(null);\n    } catch (error) {\n      console.error('Error fetching vendors:', error);\n      setError(error.message || 'Failed to load vendors');\n      setVendors([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Initial load of vendors\n  useEffect(() => {\n    fetchVendors();\n  }, []);\n\n  // Filter vendors based on search query\n  const filteredVendors = vendors.map((vendor) => {\n    const filteredProducts = vendor.products?.filter((product) => {\n      const query = searchQuery.trim().toLowerCase();\n      return (\n        product.name?.toLowerCase().includes(query) ||\n        product.brand?.toLowerCase().includes(query) ||\n        product.strain?.toLowerCase().includes(query)\n      );\n    }) || [];\n\n    return { ...vendor, products: filteredProducts };\n  });\n\n  return (\n    <div className=\"container-fluid p-0\">\n      <div className=\"vendor-list\">\n        {loading ? (\n          <p className=\"text-center my-4\">Loading vendors...</p>\n        ) : error ? (\n          <p className=\"text-danger text-center my-4\">{error}</p>\n        ) : filteredVendors.length > 0 ? (\n          filteredVendors.map((vendor) => (\n            <div key={vendor._id} className=\"vendors-page vendor-card-wrapper\">\n              <VendorCard \n                vendor={vendor}\n                orderType=\"Delivery\"\n              />\n            </div>\n          ))\n        ) : (\n          <p className=\"text-center text-muted my-4\">\n            {searchQuery ? 'No vendors match your search.' : 'No vendors found in your area.'}\n          </p>\n        )}\n      </div>\n      <Footer />\n    </div>\n  );\n};\n\nexport default NearbyVendorsPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}