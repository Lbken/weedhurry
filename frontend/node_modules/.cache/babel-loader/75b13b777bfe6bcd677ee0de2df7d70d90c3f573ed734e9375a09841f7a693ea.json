{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import api from'../api/api';// Update this import path\nimport{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();const publicRoutes=['/','/nearby','/login','/register','/add-strain'];export const AuthProvider=_ref=>{let{children}=_ref;const[auth,setAuth]=useState(null);const[loading,setLoading]=useState(true);// Updated to match api.js cookie handling\nconst clearAuthState=()=>{setAuth(null);const isDevelopment=process.env.NODE_ENV==='development';const domain=isDevelopment?'localhost':'.weedhurry.com';// Use same cookie options as api.js\nconst cookieOptions=`Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT; ${!isDevelopment?`Domain=${domain};`:''} ${!isDevelopment?'Secure; SameSite=None':''}`;document.cookie=`accessToken=; ${cookieOptions}`;document.cookie=`refreshToken=; ${cookieOptions}`;};const login=async vendorId=>{setAuth({vendorId});};const logout=async()=>{try{console.log('Starting logout process...');await api.post('/auth/logout');console.log('Logout API call successful');clearAuthState();console.log('Auth state and cookies cleared');return true;}catch(error){console.error('Logout failed:',error);clearAuthState();throw error;}};const checkAuthStatus=async()=>{if(publicRoutes.includes(window.location.pathname)){setLoading(false);return;}try{var _response$data;const response=await api.get('/auth/validate');// No need to specify withCredentials as it's set in api.js\nif((_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.success){setAuth({vendorId:response.data.vendorId});}else{// Let the api.js interceptor handle token refresh\nclearAuthState();}}catch(error){console.error('Auth check failed:',error);clearAuthState();}finally{setLoading(false);}};useEffect(()=>{const handleRouteChange=()=>{if(!publicRoutes.includes(window.location.pathname)){checkAuthStatus();}};checkAuthStatus();window.addEventListener('popstate',handleRouteChange);return()=>{window.removeEventListener('popstate',handleRouteChange);};},[]);const contextValue={auth,login,logout,loading,checkAuthStatus};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:loading&&!publicRoutes.includes(window.location.pathname)?/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"}):children});};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","api","jsx","_jsx","AuthContext","publicRoutes","AuthProvider","_ref","children","auth","setAuth","loading","setLoading","clearAuthState","isDevelopment","process","env","NODE_ENV","domain","cookieOptions","document","cookie","login","vendorId","logout","console","log","post","error","checkAuthStatus","includes","window","location","pathname","_response$data","response","get","data","success","handleRouteChange","addEventListener","removeEventListener","contextValue","Provider","value","useAuth","context","Error"],"sources":["/Users/home/Desktop/weedhurry-platform/v1/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport api from '../api/api'; // Update this import path\n\nexport const AuthContext = createContext();\n\nconst publicRoutes = ['/', '/nearby', '/login', '/register', '/add-strain'];\n\nexport const AuthProvider = ({ children }) => {\n    const [auth, setAuth] = useState(null);\n    const [loading, setLoading] = useState(true);\n\n    // Updated to match api.js cookie handling\n    const clearAuthState = () => {\n        setAuth(null);\n        const isDevelopment = process.env.NODE_ENV === 'development';\n        const domain = isDevelopment ? 'localhost' : '.weedhurry.com';\n        \n        // Use same cookie options as api.js\n        const cookieOptions = `Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT; ${\n            !isDevelopment ? `Domain=${domain};` : ''\n        } ${!isDevelopment ? 'Secure; SameSite=None' : ''}`;\n        \n        document.cookie = `accessToken=; ${cookieOptions}`;\n        document.cookie = `refreshToken=; ${cookieOptions}`;\n    };\n\n    const login = async (vendorId) => {\n        setAuth({ vendorId });\n    };\n\n    const logout = async () => {\n        try {\n            console.log('Starting logout process...');\n            await api.post('/auth/logout');\n            console.log('Logout API call successful');\n            \n            clearAuthState();\n            console.log('Auth state and cookies cleared');\n            \n            return true;\n        } catch (error) {\n            console.error('Logout failed:', error);\n            clearAuthState();\n            throw error;\n        }\n    };\n\n    const checkAuthStatus = async () => {\n        if (publicRoutes.includes(window.location.pathname)) {\n            setLoading(false);\n            return;\n        }\n\n        try {\n            const response = await api.get('/auth/validate');\n            // No need to specify withCredentials as it's set in api.js\n\n            if (response.data?.success) {\n                setAuth({ vendorId: response.data.vendorId });\n            } else {\n                // Let the api.js interceptor handle token refresh\n                clearAuthState();\n            }\n        } catch (error) {\n            console.error('Auth check failed:', error);\n            clearAuthState();\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    useEffect(() => {\n        const handleRouteChange = () => {\n            if (!publicRoutes.includes(window.location.pathname)) {\n                checkAuthStatus();\n            }\n        };\n\n        checkAuthStatus();\n        window.addEventListener('popstate', handleRouteChange);\n\n        return () => {\n            window.removeEventListener('popstate', handleRouteChange);\n        };\n    }, []);\n\n    const contextValue = {\n        auth,\n        login,\n        logout,\n        loading,\n        checkAuthStatus\n    };\n\n    return (\n        <AuthContext.Provider value={contextValue}>\n            {loading && !publicRoutes.includes(window.location.pathname) ? \n                <div>Loading...</div> : children}\n        </AuthContext.Provider>\n    );\n};\n\nexport const useAuth = () => {\n    const context = useContext(AuthContext);\n    if (!context) {\n        throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}